# Django settings related utilities
Scripts for working with Django settings in the Open edX project.

These commands assume a Python version of 3.11 or greater.

## Scripts

### `diff_settings.py`

Compare the rendered settings accross two branches.

```sh
python diff_settings.py main_branch feature_branch
```

The code in `diff_settings.py` will run commands like these for both branches (replacing `{branch_dump_dir}` depending on which branch is checked out):

```sh
# lms
SERVICE_VARIANT=lms DJANGO_SETTINGS_MODULE=lms.envs.production LMS_CFG=lms/envs/minimal.yml ./manage.py lms dump_settings > {branch_dump_dir}/lms.envs.production__lms_envs_minimal.json
SERVICE_VARIANT=lms DJANGO_SETTINGS_MODULE=lms.envs.production LMS_CFG=lms/envs/mock.yml ./manage.py lms dump_settings > {branch_dump_dir}/lms.envs.production__lms_envs_mock.json
SERVICE_VARIANT=lms DJANGO_SETTINGS_MODULE=lms.envs.tutor.production LMS_CFG=/openedx/config/lms.env.yml ./manage.py lms dump_settings > {branch_dump_dir}/lms.envs.tutor.production__openedx_config_lms.json
SERVICE_VARIANT=lms DJANGO_SETTINGS_MODULE=lms.envs.tutor.development LMS_CFG=/openedx/config/lms.env.yml ./manage.py lms dump_settings > {branch_dump_dir}/lms.envs.tutor.development__openedx_config_lms.json

# cms
SERVICE_VARIANT=cms DJANGO_SETTINGS_MODULE=cms.envs.production CMS_CFG=cms/envs/mock.yml ./manage.py cms dump_settings > {branch_dump_dir}/cms.envs.production__cms_envs_mock.json
SERVICE_VARIANT=cms DJANGO_SETTINGS_MODULE=cms.envs.tutor.production CMS_CFG=/openedx/config/cms.env.yml ./manage.py cms dump_settings > {branch_dump_dir}/cms.envs.tutor.production__openedx_config_cms.json
SERVICE_VARIANT=cms DJANGO_SETTINGS_MODULE=cms.envs.tutor.development CMS_CFG=/openedx/config/cms.env.yml ./manage.py cms dump_settings > {branch_dump_dir}/cms.envs.tutor.development__openedx_config_cms.json
```

And here is a table of the variables involved:

```
|-----------------+----------------------------+-----------------------------+------------------------------------------------|
| SERVICE_VARIANT | DJANGO_SETTINGS_MODULE     | {SERVICE}_CFG               | output file (.json)                            |
|-----------------+----------------------------+-----------------------------+------------------------------------------------|
| lms             | lms.envs.production        | lms/envs/minimal.yml        | lms.envs.production__lms_envs_minimal          |
| lms             | lms.envs.production        | lms/envs/mock.yml           | lms.envs.production__lms_envs_mock             |
| lms             | lms.envs.tutor.production  | /openedx/config/lms.env.yml | lms.envs.production__lms_envs_mock             |
| lms             | lms.envs.tutor.development | /openedx/config/lms.env.yml | lms.envs.tutor.development__openedx_config_lms |
|-----------------+----------------------------+-----------------------------+------------------------------------------------|
| cms             | cms.envs.production        | cms/envs/mock.yml           | cms.envs.production__cms_envs_mock             |
| cms             | cms.envs.tutor.production  | /openedx/config/cms.env.yml | cms.envs.tutor.production__openedx_config_cms  |
| cms             | cms.envs.tutor.development | /openedx/config/cms.env.yml | cms.envs.tutor.development__openedx_config_cms |
|-----------------+----------------------------+-----------------------------+------------------------------------------------|
```

### `extract_django_settings.py`

Generate files that contain a set of settings defined in a particular settings module. This is only concerned about those settings
defined or overridden in the particular module, not settings that the module inherits.

```sh
# common
python extract_django_settings.py openedx/envs/common.py  # --> will output openedx_envs_common.py

# lms
python extract_django_settings.py lms/envs/common.py
python extract_django_settings.py lms/envs/production.py
python extract_django_settings.py lms/envs/test.py

python extract_django_settings.py lms/envs/tutor/development.py
python extract_django_settings.py lms/envs/tutor/production.py
python extract_django_settings.py lms/envs/tutor/test.py

# cms
python extract_django_settings.py cms/envs/common.py
python extract_django_settings.py cms/envs/production.py
python extract_django_settings.py cms/envs/test.py

python extract_django_settings.py cms/envs/tutor/development.py
python extract_django_settings.py cms/envs/tutor/production.py
python extract_django_settings.py cms/envs/tutor/test.py
```

### `set_combiner.py`

Used to combine the Python set objects in the files generated by `extract_django_settings.py`.

```sh
python set_combiner.py  # --> will output combined_sets.py by default
```
